---
title: "Blue-Green 배포 방식"
date: 2019-11-14
categories: DEV SERVER
---

`Blue-Green배포방식`

시작하기
===

오랜만에 포스팅을 한다. 포스팅이 뜸했다고 공부를 안한것은 아니다! 학교 시험일정과 준비했던 프로젝트와, 추후 활동(?)계획 때문에 그렇다! 사실 지금도 과제하나가 남아있지만, 공부내용을 정리하고! 과제의 늪으로 들어가겠다.


오늘은 BlueGreen배포방식에 대한 포스팅을 하려고한다. 그렇다면 `무중단배포(Continuous Delivery)`에 대해 알아야하는데, 기존에 운영중인 서비스에 새로운 API를 배포하고싶다. 그러면 이 API가 서버에 올라가는 시간에 서비스를 중단하여야 할까?


잠시라도 이렇게 서비스가 중단되어버리면, 요즘 사람들은 아마도 서비스를 집어던질 것이다. 왜냐하면 불편하기 때문에! 그리고 어떤 중요한 업무영역에서는 큰 문제점이 될것임에 틀림없다.


블루 그린배포란?
===

말그대로 무중단배포라는 것은 이 API를 배포하는 도중에 서비스를 끊지 않고, 연속적으로 배포되는 방식이다!. 얼마나 혁신적인 기술인가.. 그렇지만 이 기술에도 단점은 존재했다. 마지막 실제 서비스단계로 향하기전 서비스가 아주 잠시 중단되는 시기가 존재한 것 이다.

 > 극단적인 예, 온라인 결제를 이용하여 결제시도로 넘어가던 중, 중간에 서버가  
 > 중단되는 현상이 발생한다면, 어마어마한 서비스이용자, 제공자 모두 어마어마한 골칫덩이가 생길것이다.

 그래서 고안된, **블루 그린 배포방식** 


 ![bluegreen]({{"/asset/bluegreen.png}})


 기존에 초록색이 실제 운영중인 환경이라고 한다면, 새로운 버전은 파란색에서 진행한다. 테스트 서버가 생성되는 것이다. 그리고 이 테스트가 정상적인 반응을 보이고 완전한 상태가 되었다면, 새로 업데이트된 파란색으로 기존 초록색의 모든 요청이 향하게 된다. 대체되는 것이다!

블루 그린배포시 고려사항
===
1.  기존 초록색서버에서 긴 실행시간을 가지는 트랜잭션이 수행중이라면, 라우터설정이 변경되었을때, 이 트랙잭션의 수행에 문제가 생기게 된다.

2. Database의 Migration작업비용과 문제가 생겼을 때를 대비한 Rollback을 고려해야한다.


동일한 환경이 2개라면 한쪽은 뭘할까?
===
예를 들어, 기존의 그린의 라우터설정이 모두 블루로 향하게 되었다면, 그린은 어떻게 할까? 그린은 다양한 용도로 사용할 수 있는데, 백업용으로 둔다거나, 다음 배포를 위한 staging, 만약 무엇인가 잘못된다면, 다시 기존대로 스위칭할 수 있는 역할이 된다. 하지만, 기존의 환경과 최대한 동일한 것이 2개가 필요하기 때문에, 기존의 Cost의 2배가 요구된다.


[jekyll-docs]: https://jekyllrb.com/docs/home
[jekyll-gh]:   https://github.com/jekyll/jekyll
[jekyll-talk]: https://talk.jekyllrb.com/